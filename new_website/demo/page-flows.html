<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="NormCode Page-Flows Client — Step-by-step guided workflow">
    <meta name="theme-color" content="#4DA3FF">
    <link rel="icon" type="image/png" href="../assets/images/logo.png">
    <title>Page-Flows — PsylensAI</title>

    <!-- Shared site fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=IBM+Plex+Sans:wght@400;500;600&family=IBM+Plex+Mono:wght@400;500&display=swap" rel="stylesheet">

    <!-- Shared site CSS -->
    <link rel="stylesheet" href="../css/variables.css">
    <link rel="stylesheet" href="../css/base.css">
    <link rel="stylesheet" href="../css/components.css">
    <link rel="stylesheet" href="../css/layout.css">
    <link rel="stylesheet" href="../css/responsive.css">

    <link rel="stylesheet" href="css/page-flows.css">
</head>
<body>
    <a href="#main" class="skip-link">Skip to content</a>

    <main id="main">
        <div class="pf-wrapper">
            <!-- Step dots -->
            <div class="pf-dots">
                <div class="pf-dot active" onclick="goTo(0)"></div>
                <div class="pf-dot" onclick="goTo(1)"></div>
                <div class="pf-dot" onclick="goTo(2)"></div>
                <div class="pf-dot" onclick="goTo(3)"></div>
                <div class="pf-dot" onclick="goTo(4)"></div>
            </div>

            <!-- Card -->
            <div class="pf-card">
                <!-- Step 0: Connection -->
                <div class="pf-step active" data-step="0">
                    <div class="pf-step-title" data-i18n="pf.s0title">Connection</div>
                    <div class="pf-step-subtitle" data-i18n="pf.s0sub">Verifying server and loading configuration...</div>
                    <div style="flex:1;overflow-y:auto">
                        <div class="pf-info-row">
                            <span class="pf-status-dot" id="pfConnDot"></span>
                            <span class="pf-info-label" data-i18n="pf.labelServer">Server</span>
                            <span class="pf-info-value" id="pfServer">—</span>
                        </div>
                        <div class="pf-info-row">
                            <span class="pf-info-label" data-i18n="pf.labelPlan">Plan</span>
                            <span class="pf-info-value" id="pfPlan">—</span>
                        </div>
                        <div class="pf-info-row pf-model-row" id="pfModelRow" onclick="toggleModelDropdown()">
                            <span class="pf-info-label" data-i18n="pf.labelModel">Model</span>
                            <span class="pf-info-value" id="pfModel">—</span>
                            <span class="pf-model-change" data-i18n="pf.changeModel">change</span>
                            <div class="pf-model-dropdown" id="pfModelDropdown"></div>
                        </div>
                        <div class="pf-connect-msg" id="pfConnMsg" data-i18n="pf.connecting">Connecting...</div>

                        <!-- Tool diagnostics -->
                        <div class="pf-tools-section" id="pfToolsSection" style="display:none">
                            <div class="pf-tools-header">
                                <span class="pf-tools-label" data-i18n="pf.toolsLabel">Tools</span>
                                <span>
                                    <span class="pf-tools-badge" id="pfToolsBadge"></span>
                                    <button class="pf-tools-retest" onclick="pfRunToolTests()" data-i18n="pf.retest">retest</button>
                                </span>
                            </div>
                            <div class="pf-tools-grid" id="pfToolsGrid"></div>
                        </div>
                    </div>
                </div>

                <!-- Step 1: Basic Inputs -->
                <div class="pf-step" data-step="1">
                    <div class="pf-step-title" data-i18n="pf.s1title">Basic Inputs</div>
                    <div class="pf-step-subtitle" data-i18n="pf.s1sub">What should this presentation be about?</div>
                    <div style="flex:1">
                        <div class="pf-field">
                            <label data-i18n-html="pf.labelTopic">Topic <span class="pf-required">*</span></label>
                            <input type="text" id="pfTopic" value="">
                        </div>
                        <div class="pf-field">
                            <label data-i18n="pf.labelAudience">Audience</label>
                            <input type="text" id="pfAudience" value="">
                        </div>
                        <div class="pf-field">
                            <label data-i18n="pf.labelLength">Length</label>
                            <input type="text" id="pfLength" value="">
                        </div>
                    </div>
                </div>

                <!-- Step 2: References -->
                <div class="pf-step" data-step="2">
                    <div class="pf-step-title" data-i18n="pf.s2title">References</div>
                    <div class="pf-step-subtitle" data-i18n="pf.s2sub">Add content, templates, or style guides (optional).</div>
                    <div style="flex:1;overflow-y:auto">
                        <!-- Content refs -->
                        <div class="pf-ref-section">
                            <div class="pf-ref-label" data-i18n="pf.refContent">Content Files</div>
                            <div class="pf-file-list" id="pfContentList"></div>
                            <div class="pf-drop-area" id="pfContentDrop"
                                 onclick="document.getElementById('pfContentInput').click()"
                                 ondrop="pfDrop(event,'content')" ondragover="pfDragOver(event)" ondragleave="pfDragLeave(event)">
                                <span data-i18n="pf.dropContent">+ Add .md, .txt, .json</span>
                                <input type="file" id="pfContentInput" multiple hidden onchange="pfFiles(event,'content')">
                            </div>
                        </div>
                        <!-- Template refs -->
                        <div class="pf-ref-section">
                            <div class="pf-ref-label" data-i18n="pf.refTemplate">HTML Templates</div>
                            <div class="pf-file-list" id="pfTemplateList"></div>
                            <div class="pf-drop-area" id="pfTemplateDrop"
                                 onclick="document.getElementById('pfTemplateInput').click()"
                                 ondrop="pfDrop(event,'template')" ondragover="pfDragOver(event)" ondragleave="pfDragLeave(event)">
                                <span data-i18n="pf.dropTemplate">+ Add .html</span>
                                <input type="file" id="pfTemplateInput" multiple hidden onchange="pfFiles(event,'template')">
                            </div>
                        </div>
                        <!-- Style refs -->
                        <div class="pf-ref-section">
                            <div class="pf-ref-label" data-i18n="pf.refStyle">Style Guides</div>
                            <div class="pf-file-list" id="pfStyleList"></div>
                            <div class="pf-drop-area" id="pfStyleDrop"
                                 onclick="document.getElementById('pfStyleInput').click()"
                                 ondrop="pfDrop(event,'style')" ondragover="pfDragOver(event)" ondragleave="pfDragLeave(event)">
                                <span data-i18n="pf.dropStyle">+ Add .css, .md, .txt</span>
                                <input type="file" id="pfStyleInput" multiple hidden onchange="pfFiles(event,'style')">
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 3: Review & Launch -->
                <div class="pf-step" data-step="3">
                    <div class="pf-step-title" data-i18n="pf.s3title">Review & Launch</div>
                    <div class="pf-step-subtitle" data-i18n="pf.s3sub">Confirm your settings and start generation.</div>
                    <div style="flex:1">
                        <div id="pfReviewContent"></div>
                        <button class="pf-launch-btn" id="pfLaunchBtn" onclick="launchRun()" data-i18n="pf.launch">Launch</button>
                    </div>
                </div>

                <!-- Step 4: Running -->
                <div class="pf-step" data-step="4">
                    <div class="pf-step-title" data-i18n="pf.s4title">Running</div>
                    <div class="pf-step-subtitle" id="pfRunSub" data-i18n="pf.runSub">Generating your presentation...</div>
                    <div style="flex:1;display:flex;flex-direction:column;overflow:hidden">
                        <div class="pf-progress-bar">
                            <div class="pf-progress-fill" id="pfProgressFill"></div>
                        </div>
                        <div class="pf-run-status" id="pfRunStatus" data-i18n="pf.runWaiting">Waiting...</div>

                        <!-- Step timeline -->
                        <div class="pf-section-label" data-i18n="pf.timelineTitle">Steps</div>
                        <div class="pf-timeline" id="pfTimeline"></div>

                        <!-- Files produced -->
                        <div class="pf-files-toggle" id="pfFilesToggle" onclick="this.classList.toggle('open')">
                            <span data-i18n="pf.filesTitle">Files</span>
                            <span class="pf-toggle-arrow">&#9654;</span>
                        </div>
                        <div class="pf-files-body" id="pfFilesBody">
                            <div id="pfFinalFiles"></div>
                            <div id="pfIntermediateFiles"></div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Navigation -->
            <div class="pf-nav">
                <button class="pf-btn pf-btn-back" id="pfBtnBack" onclick="prevStep()" disabled data-i18n-html="pf.back">&larr; Back</button>
                <button class="pf-btn pf-btn-next" id="pfBtnNext" onclick="nextStep()" disabled data-i18n-html="pf.next">Next &rarr;</button>
            </div>
        </div>
    </main>

    <!-- Preview modal -->
    <div class="pf-modal-overlay" id="pfPreviewOverlay" onclick="closePreview(event)">
        <div class="pf-modal" onclick="event.stopPropagation()">
            <div class="pf-modal-header">
                <span class="pf-modal-title" id="pfPreviewTitle"></span>
                <div class="pf-modal-actions">
                    <button class="pf-modal-toggle" id="pfPreviewToggle" onclick="togglePreviewMode()" style="display:none" data-i18n="pf.rendered">Rendered</button>
                    <button class="pf-modal-close" onclick="closePreview()">&times;</button>
                </div>
            </div>
            <div class="pf-modal-body" id="pfPreviewBody"></div>
        </div>
    </div>

    <!-- Shared navigation (i18n + nav) -->
    <script src="../js/i18n.js"></script>
    <script src="../js/nav.js"></script>

    <!-- Page-flows modules -->
    <script src="js/page-flows-i18n.js"></script>
    <script src="js/page-flows-state.js"></script>
    <script src="js/page-flows-core.js"></script>
    <script src="js/page-flows-files.js"></script>
    <script src="js/page-flows-exec.js"></script>
    <script src="js/page-flows-init.js"></script>

</body>
</html>
