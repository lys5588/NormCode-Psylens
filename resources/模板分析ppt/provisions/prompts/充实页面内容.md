# 充实页面内容

## ⚠️ 核心任务：纠正草稿

**草稿可能包含错误！你的任务是用参考资料纠正它。**

草稿是根据大纲自动生成的，可能存在：
- ❌ 错误的术语或名称（如用"AI框架"代替正确的产品名"NormCode"）
- ❌ 不准确的描述（如功能描述与实际不符）
- ❌ 缺失的关键信息（如漏掉重要特性）

**你的职责**：
1. **核对**：将草稿内容与内容参考**逐一比对**，发现错误
2. **纠正**：用内容参考中的**准确表述**替换错误内容
3. **调整**：按风格参考调整语气和用词

## 任务目标

使用内容参考和风格参考，**纠正和充实**页面内容草稿，生成最终的文本替换列表。

## 输入

### 1. 页面内容草稿 `{页面内容草稿}`
<content_draft>
$input_1
</content_draft>

草稿步骤生成的内容（使用 slot 编号），格式如下：

```json
{
  "slide_index": 1,
  "replacements": [
    {"slot": 1, "text": "AI核心技术", "target_length": 5},
    {"slot": 2, "text": "机器学习", "target_length": 5},
    {"slot": 3, "text": "数据驱动的模型训练", "target_length": 8}
  ]
}
```

**注意**：草稿有几个 slot，你就保持几个 slot，不能增加也不能删除！

**字段说明**：
- `slot`: 位置编号（1, 2, 3...）
- `text`: 草稿文本
- `target_length`: 目标中文字数（优化后的文本长度应接近此值）

### 2. 所有内容参考 `{所有内容参考}`
<content_references>
$input_2
</content_references>

领域知识材料列表，每个元素包含：
- `name`: 参考名称（如"公司介绍"）
- `type`: 类型（如 company_info, technical）
- `content`: 实际内容文本

**用途**：从中提取具体数据、事实、术语来纠正草稿。

### 3. 所有风格参考 `{所有风格参考}`
<style_references>
$input_3
</style_references>

写作风格指南列表，每个元素包含：
- `name`: 指南名称（如"内容风格指南"、"受众适应指南"）
- `for`: 用途（如"内容写作风格"、"受众适应策略"）
- `content`: 指南内容

**用途**：指导语言风格、用词选择、表达方式。

## 任务

**纠正**草稿中的每个文本：

1. **核对**：将草稿与内容参考比对，找出错误或不准确的地方
2. **纠正**：用内容参考中的**正确信息**替换错误内容
3. **充实**：补充草稿中缺失的关键信息（必须来自内容参考）
4. **调整**：按风格参考调整语气和用词
5. **保持**：保持 slot 编号不变，只修改 text 内容

## 输出格式

返回带有 `thinking` 和 `result` 字段的 JSON：

```json
{
  "thinking": "1. 核对草稿 slot 数量：共 3 个 slot [1, 2, 3]\n\n2. 核对草稿，发现错误:\n- slot 1: 'AI核心技术' ❌ 错误！公司介绍中明确说是'NormCode规范化推理框架'\n- slot 2: '机器学习' ❌ 错误！内容参考中核心特性是'上下文隔离'，不是机器学习\n- slot 3: '数据驱动的模型训练' ❌ 与公司介绍不符，应该是'每一步推理只能访问显式传入的数据'\n\n3. 纠正内容（全部来自内容参考）:\n- slot 1: 纠正为'规范化推理框架'（公司介绍第2段）\n- slot 2: 纠正为'上下文隔离'（公司介绍-核心特性）\n- slot 3: 纠正为上下文隔离的具体描述（公司介绍-核心特性）\n\n4. 风格调整: 按受众适应指南使用商业语言\n\n5. 确认输出：保持 3 个 slot，与草稿一致 ✓",
  "result": {
    "slide_index": 1,
    "replacements": [
      {"slot": 1, "text": "规范化推理框架"},
      {"slot": 2, "text": "上下文隔离"},
      {"slot": 3, "text": "每一步仅用显式输入数据，防止信息泄露"}
    ]
  }
}
```

**⚠️ 注意：草稿有 3 个 slot，输出也保持 3 个 slot！**

## 纠正规则

### 1. 保持 slot 编号不变

- **直接复制** 草稿中的所有 slot 编号
- **禁止** 添加新的 slot 或删除现有的
- **禁止** 修改 slot 的值
- 只优化对应的 text 内容

### 2. 用内容参考纠正草稿（禁止编造！）

**将草稿与内容参考逐一比对，发现并纠正错误**：

| 草稿内容 | 与内容参考比对 | 操作 |
|---------|---------------|------|
| 错误术语/名称 | ❌ 与参考不符 | **纠正为参考中的正确表述** |
| 不准确描述 | ❌ 与参考不符 | **纠正为参考中的准确描述** |
| 正确内容 | ✅ 与参考一致 | 保持不变 |
| 无法验证 | ❓ 参考中无相关信息 | 保留草稿原文 |

**禁止行为**：
- ❌ 编造内容参考中不存在的数据或事实
- ❌ 凭空添加"听起来合理"的细节
- ❌ 用自己的知识"纠正"（可能引入新错误）

### 3. 严格遵循风格参考

**必须按风格参考的要求调整表达**：

| 风格指南 | 必须遵循的内容 |
|---------|---------------|
| 受众适应指南 | 专业程度、用词选择、表达深度 |
| 内容风格指南 | 语气（正式/轻松）、结构、措辞习惯 |

**禁止行为**：
- ❌ 忽略风格参考中的具体要求
- ❌ 使用与风格指南相悖的表达方式
- ❌ 自作主张调整风格

### 4. ⭐ 严格遵守目标长度（非常重要！）

**`target_length` 是目标中文字数，必须严格遵守！**

- 每个 slot 的输出文本长度必须接近 `target_length`
- **允许偏差：±20%**（例如 target=10，输出应为 8-12 字）
- **严禁过短**：target=50 却只写 10 字 ❌
- **严禁过长**：target=5 却写 20 字 ❌

**长度控制示例**：

| target_length | 允许范围 | 正确示例 | 错误示例 |
|--------------|---------|---------|---------|
| 5 | 4-6 字 | "上下文隔离" (5字) ✅ | "基于数据隔离的安全机制" (10字) ❌ |
| 10 | 8-12 字 | "每步仅用显式输入数据" (9字) ✅ | "数据" (2字) ❌ |
| 50 | 40-60 字 | 写一段完整的描述 ✅ | 只写一句话 ❌ |
| 300 | 240-360 字 | 写多段完整论述 ✅ | 只写几十字 ❌ |

**如何处理内容与长度冲突**：
- 内容太长 → 精简表达，保留核心信息
- 内容太短 → 适当展开，但不能编造

### 5. 内容一致性

- 同一页面的多个 block 保持风格统一
- 使用统一的术语（如确定了"NormCode"就不要混用"规范代码"）
- 并列内容的字数应大致相当

## 特殊情况处理

### 内容参考中找不到相关信息

如果无法从内容参考中找到更好的表述：
- 保留草稿原文
- 仅做风格微调
- 不要编造数据或事实

### 草稿内容正确

如果草稿与内容参考比对后确认无误：
- 保持原文不变
- 在 thinking 中说明"与内容参考比对，草稿正确，保持不变"

### 草稿内容有误

如果发现草稿与内容参考不符：
- 在 thinking 中**明确指出错误**和**正确来源**
- 用内容参考中的正确信息替换
- 例如："草稿写'AI框架' ❌ 但公司介绍明确说是'NormCode' → 纠正"

## 质量检查

生成前**必须**在 thinking 中完成：

### 第一步：核对 slot 编号（⚠️ 最关键！）
确认输出的 slot 数量和编号与草稿完全一致：
> "草稿中的 slot: [1, 2, 3]，共 3 个"
> "输出中的 slot: [1, 2, 3]，共 3 个 ✓ 完全一致"

**严禁增加或删除 slot！草稿有几个，输出就几个！**

### 第二步：核对并纠正
逐一将草稿与内容参考比对，发现错误并纠正：
> "slot 1: '草稿内容' ❌ 与公司介绍不符 → 纠正为 '正确内容'（来源：公司介绍第X段）"
> "slot 2: '草稿内容' ✓ 与内容参考一致，保持不变"

### 第三步：长度核对（⭐ 必须逐一检查！）
逐一检查优化后文本长度是否接近 `target_length`（±20%）：
> "slot 1: target_length=5, 允许范围4-6字, 输出'规范化推理'=5字 ✓"
> "slot 2: target_length=10, 允许范围8-12字, 输出'上下文隔离机制'=6字 ❌ 太短！→ 改为'基于上下文隔离的数据保护'=10字 ✓"
> "slot 3: target_length=50, 允许范围40-60字, 输出只有15字 ❌ 严重不足！→ 需要展开论述"

**每个 slot 都必须在允许范围内！不符合的必须调整！**

### 第四步：风格检查
> "已按受众适应指南调整为商业语言"
> "保持了简洁有力的风格"

### 检查清单
- ✅ **slot 数量与草稿完全一致**（草稿有3个就输出3个）
- ✅ 所有 slot 编号与草稿一致
- ✅ **逐一比对草稿与内容参考，发现并纠正了所有错误**
- ✅ **所有纠正都有明确来源（内容参考中的具体位置）**
- ✅ 应用了风格参考的指导
- ✅ **每个 slot 的文本长度都在 target_length ±20% 范围内**（必须逐一核对！）
- ✅ 同一页面风格统一
- ✅ 没有编造数据或事实

**❌ 常见错误：**
1. target_length=50 却只输出 10 字 — 严重不足！
2. target_length=5 却输出 20 字 — 严重超长！

**重要：** 你的响应必须是有效的JSON，且必须包含这两个顶级键（thinking 和 result）。
