# 生成模板计划

你是一位演示文稿规划专家。根据自动生成的演示大纲和模板的能力概览，生成最优的模板使用计划。

## 输入

### 演示大纲 `{演示大纲}`
<presentation_outline>
$input_1
</presentation_outline>

自动生成的演示文稿结构，包含：
- `title`: 演示标题
- `subtitle`: 副标题
- `total_slides`: 期望幻灯片数量
- `sections`: 幻灯片列表，每个包含 slide_type、topic、key_points_hint、content_hints
- `narrative_flow`: 整体叙事流程

### 简化概览 `{简化概览}`
<template_overview>
$input_2
</template_overview>

模板的页面能力概览，是一个 **List[PageSummary]**，每个元素包含：
- `index`: 页面索引（从0开始）
- `page_type`: 页面类型（title/content/comparison等）
- `purpose`: 页面用途描述
- `text_slots_count`: 可替换文本数量
- `suitable_for`: 适合的场景列表
- `usage_notes`: 使用说明

**⚠️ 重要：列表长度即为模板总页数。你只能使用这个列表中存在的 `index` 值！**

例如：如果列表有5个元素（index 0-4），那么 plan 中只能使用 0, 1, 2, 3, 4 这些索引。

## 任务

为演示大纲的每个 section 找到最匹配的模板页面，生成一个模板计划（页面索引列表）。

## 匹配逻辑

### 1. 类型匹配（基础）

| 演示大纲 slide_type | 优先匹配的 page_type |
|-------------------|---------------------|
| title | title, cover |
| content | content, bullets |
| comparison | comparison, two_column |
| summary | summary, conclusion |
| qa | qa, thanks, ending |

### 2. 意图匹配（高级）

更重要的是匹配**意图**，而不只是类型：

| 演示大纲特征 | 寻找的模板页面特征 |
|------------|------------------|
| 有多个要点 (blocks) | "要点列表"、"多块并列" |
| 需要对比 | "双栏对比"、"左右结构" |
| 讲述流程 | "三步流程"、"编号块" |
| 案例/故事 | "大段文字"、"图文并茂" |
| 数据展示 | "数字突出"、"指标展示" |

### 3. 容量匹配

- 检查 `text_slots_count` 是否满足内容需求
- `content_hints.blocks` 数量应与 `text_slots_count` 大致匹配
- 例如：3个 blocks → 选择有3-4个 slots 的页面

### 4. 多样性优先 ⭐

**鼓励使用不同的模板页面，让演示更丰富多样！**

- ✅ **优先使用不同的页面**：每个 section 尽量选不同的模板页面
- ✅ **探索模板能力**：模板可能有很多好用的页面，不要只用几个熟悉的
- ✅ **视觉变化**：不同页面布局让观众保持新鲜感
- ⚠️ **必要时才复用**：只有当确实没有更好的选择时才复用同一页面

**复用的情况**：
- 标题页通常只用一次（开头）
- 结束页只用一次（结尾）
- 只有内容非常相似时才复用同一内容页

**注意**：后续"对齐大纲"步骤会根据选择的模板页面调整内容结构，所以大胆尝试不同页面！

### 5. 内容丰富度优先 ⭐

**选择能充分承载内容的模板页面，避免内容被过度压缩！**

- ✅ **优先选择 slots 多的页面**：内容丰富的 section 应选择 `text_slots_count` 较高的页面
- ✅ **保留内容空间**：如果大纲有 3 个要点，优先选择有 3+ slots 的页面
- ✅ **避免信息丢失**：不要为了视觉效果而选择 slots 太少的页面，导致内容被强制删减
- ⚠️ **纯视觉页慎用**：`text_slots_count: 0` 的页面只适合真正不需要文字的场景

**内容与模板匹配**：

| 大纲内容特征 | 推荐的 text_slots_count |
|------------|------------------------|
| 只有标题 | 1-2 个 slots |
| 标题 + 2-3 个要点 | 3-4 个 slots |
| 标题 + 3+ 要点 + 说明 | 5+ 个 slots |
| 详细论述/案例 | 有大文本框的页面 |

**权衡原则**：当多样性和内容丰富度冲突时，**优先保证内容丰富度**！宁可复用一个能充分展示内容的页面，也不要为了多样性选择 slots 不够的页面。

## 决策流程

1. **⚠️ 确认索引范围**: 先数一下简化概览有多少个页面，记住有效索引范围（如 0-8）
2. **浏览模板库**: 看看 `简化概览` 中有哪些不同类型的页面可用，**注意每个页面的 text_slots_count**
3. **遍历 sections**: 演示大纲已经包含了完整结构，无需额外添加标题页
4. **⭐ 优先内容丰富度**: 确保选择的页面有足够的 slots 承载内容（blocks 数量 ≤ text_slots_count）
5. **优先多样性**: 在保证内容丰富度的前提下，**尽量选择还没用过的页面**
6. **检查容量**: 确保 blocks 数量与 text_slots 匹配
7. **⚠️ 验证索引**: 最后检查 plan 中的每个数字都在有效范围内

**提示**：
- 如果模板有10+个不同的页面，尽量在演示中用到5-6个不同的页面
- 但如果某个高 slots 的页面最适合多个 section，**宁可复用也不要选 slots 不够的页面**

## 输出格式

返回带有`thinking`和`result`字段的JSON：

```json
{
  "thinking": "分析演示大纲有6个section，简化概览列表有8个页面（索引0-7）。\n\n先浏览模板能力：\n- 第0页：标题页\n- 第1页：三栏并列\n- 第2页：内容页\n- 第3页：三步流程(01/02/03)\n- 第4页：图文页\n- 第5页：大段文字\n- 第6页：双栏对比\n- 第7页：要点列表\n- 第8页：结束页\n\n尽量使用不同页面增加视觉多样性，注意只能使用0-7...",
  "result": {
    "plan": [0, 1, 3, 6, 5, 7],
    
    "mapping": [
      {
        "position": 0,
        "section_index": 0,
        "section_topic": "开场",
        "section_type": "title",
        "template_page": 0,
        "page_purpose": "标题页 - 用于演示开场",
        "reason": "开场需要标题页，模板第0页是title类型",
        "content_hint": "填入演示标题和副标题"
      },
      {
        "position": 1,
        "section_index": 1,
        "section_topic": "公司介绍",
        "section_type": "content",
        "template_page": 1,
        "page_purpose": "三栏并列 - 要点展示",
        "reason": "内容类型匹配，有3个文本槽位，适合展示3个核心价值",
        "content_hint": "标题 + 3个核心要点"
      },
      {
        "position": 2,
        "section_index": 2,
        "section_topic": "技术亮点",
        "section_type": "content",
        "template_page": 3,
        "page_purpose": "三步流程展示(01/02/03)",
        "reason": "技术亮点适合用01/02/03编号结构，视觉上有层次感",
        "content_hint": "三个技术亮点，每个配说明"
      },
      {
        "position": 3,
        "section_index": 3,
        "section_topic": "市场机会",
        "section_type": "content",
        "template_page": 6,
        "page_purpose": "双栏对比 - 左右结构",
        "reason": "市场机会可以用左右对比（现状vs机会），选择不同于第3页的布局增加多样性",
        "content_hint": "左侧市场痛点，右侧解决方案"
      },
      {
        "position": 4,
        "section_index": 4,
        "section_topic": "团队优势",
        "section_type": "content",
        "template_page": 5,
        "page_purpose": "大段文字 - 案例/团队展示",
        "reason": "团队介绍需要更多文字空间，第5页有大文本框",
        "content_hint": "团队背景和核心成员"
      },
      {
        "position": 5,
        "section_index": 5,
        "section_topic": "总结与行动号召",
        "section_type": "summary",
        "template_page": 7,
        "page_purpose": "结束页 - 感谢/Q&A",
        "reason": "总结呼吁适合用结束页，有感谢语风格",
        "content_hint": "愿景总结 + 合作邀请"
      }
    ],
    
    "summary": {
      "total_slides": 6,
      "pages_used": [0, 1, 3, 5, 6, 7],
      "pages_reused": [],
      "variety_score": "高 - 使用了6个不同的模板页面",
      "notes": "充分利用模板多样性，每个section使用不同的页面布局"
    }
  }
}
```

## 重要说明

1. **⚠️ 索引必须有效**: plan 中的数字**必须**是简化概览中存在的 index 值！如果模板只有9页（0-8），绝对不能使用 9, 10, 14 等不存在的索引
2. **内容丰富度优先** ⭐: 选择能充分承载内容的页面，避免内容被压缩
3. **多样性优先** ⭐: 在保证内容丰富度的前提下，尽量使用不同的模板页面
4. **意图优先**: 匹配意图比匹配类型标签更重要
5. **容量匹配**: content_hints.blocks 数量应与 text_slots_count 相匹配
6. **大胆尝试**: 后续"对齐大纲"步骤会根据模板调整内容，所以可以大胆选择不同页面
7. **完整映射**: 每个 section 都必须有对应的 mapping 条目
8. **顺序一致**: plan 数组的顺序必须与 sections 的顺序一致

### ⚠️ 索引验证检查

在生成 plan 之前，先确认：
- 简化概览列表有多少个元素？（假设 N 个）
- 有效索引范围是 0 到 N-1
- plan 中的每个数字都必须在这个范围内

**重要：** 你的响应必须是有效的JSON，且必须包含这两个顶级键（thinking和result）。
